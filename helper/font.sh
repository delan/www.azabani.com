#!/bin/sh
set -eu

O="$(pwd)"
D="$O/asset"
S='Â Â¡Â¢Â£Â¤Â¥Â¦Â§Â¨Â©ÂªÂ«Â¬Â­Â®Â¯Â°Â±Â²Â³Â´ÂµÂ¶Â·Â¸Â¹ÂºÂ»Â¼Â½Â¾Â¿Ã€ÃÃ‚ÃƒÃ„Ã…Ã†Ã‡ÃˆÃ‰ÃŠÃ‹ÃŒÃÃŽÃÃÃ‘Ã’Ã“Ã”Ã•Ã–Ã—Ã˜Ã™ÃšÃ›ÃœÃÃžÃŸÃ Ã¡Ã¢Ã£Ã¤Ã¥Ã¦Ã§Ã¨Ã©ÃªÃ«Ã¬Ã­Ã®Ã¯Ã°Ã±Ã²Ã³Ã´ÃµÃ¶Ã·Ã¸Ã¹ÃºÃ»Ã¼Ã½Ã¾Ã¿Å¿Æ’È€ÈÈ‚ÈƒÈ„È…È†È‡ÈˆÈ‰ÈŠÈ‹ÈŒÈÈŽÈÈÈ‘È’È“È”È•È–È—È˜È™ÈšÈ›ÈœÈÈžÈŸÈ È¡È¢È£È¤È¥È¦È§È¨È©ÈªÈ«È¬È­È®È¯È°È±È²È³È´ÈµÈ¶È·È¸È¹ÈºÈ»È¼È½È¾È¿É€ÉÉ‚ÉƒÉ„É…É†É‡ÉˆÉ‰ÉŠÉ‹ÉŒÉÉŽÉÉÉ‘É’É“É”É•É–É—É˜É™ÉšÉ›ÉœÉÉžÉŸÉ É¡É¢É£É¤É¥É¦É§É¨É©ÉªÉ«É¬É­É®É¯É°É±É²É³É´ÉµÉ¶É·É¸É¹ÉºÉ»É¼É½É¾É¿Ê€ÊÊ‚ÊƒÊ„Ê…Ê†Ê‡ÊˆÊ‰ÊŠÊ‹ÊŒÊÊŽÊÊÊ‘Ê’Ê“Ê”Ê•Ê–Ê—Ê˜Ê™ÊšÊ›ÊœÊÊžÊŸÊ Ê¡Ê¢Ê£Ê¤Ê¥Ê¦Ê§Ê¨Ê©ÊªÊ«Ê¬Ê­Ê®Ê¯Ê°Ê±Ê²Ê³Ê´ÊµÊ¶Ê·Ê¸Ê¹ÊºÊ»Ê¼Ê½Ê¾Ê¿Ë€ËË‚ËƒË„Ë…Ë†Ë‡ËˆË‰ËŠË‹ËŒËËŽËËË‘Ë’Ë“Ë”Ë•Ë–Ë—Ë˜Ë™ËšË›ËœËËžËŸË Ë¡Ë¢Ë£Ë¤Ë¥Ë¦Ë§Ë¨Ë©ËªË«Ë¬Ë­Ë®Ë¯Ë°Ë±Ë²Ë³Ë´ËµË¶Ë·Ë¸Ë¹ËºË»Ë¼Ë½Ë¾Ë¿Î“Î˜Î£Î¦Î©Î±Î´ÎµÏ€ÏƒÏ„Ï†Ø§Ø¯Ù„Ù†ÛŒâ€â€‘â€’â€“â€”â€•â€–â€—â€˜â€™â€šâ€›â€œâ€â€žâ€Ÿâ€¢â€²â€³â€´â€¼â¿â‚§â„¢â†â†‘â†’â†“â†”â†•â†¨âˆ™âˆšâˆžâˆŸâˆ©â‰ˆâ‰¡â‰¤â‰¥âŒ‚âŒâŒ âŒ¡â€ââ‚âƒâ„â…â†â‡âˆâ‰âŠâ‹âŒââŽâââ‘â’â“â”â•â–â—â˜â™âšâ›âœââžâŸâ â¡â¢â£â¤â¥â¦â”€â”‚â”Œâ”â””â”˜â”œâ”¤â”¬â”´â”¼â•â•‘â•’â•“â•”â••â•–â•—â•˜â•™â•šâ•›â•œâ•â•žâ•Ÿâ• â•¡â•¢â•£â•¤â•¥â•¦â•§â•¨â•©â•ªâ•«â•¬â–€â–„â–ˆâ–Œâ–â–‘â–’â–“â– â–¬â–²â–ºâ–¼â—„â—‹â—˜â—™â˜ºâ˜»â˜¼â™€â™‚â™ â™£â™¥â™¦â™ªâ™«ðŸ“–'

cd helper

path="$D/$1"; shift
family="$1"; shift
weight="$1"; shift
style="$1"; shift
base="$(basename -- "$path")"
result="-${base%.*}.woff"

. .venv/bin/activate

(
    set -x

    >&2 npx glyphhanger --formats=woff2 --subset="$path"
    mv -- "$D/${base%.*}-subset.woff2" "$D/${base%.*}.woff2"

    >&2 npx glyphhanger --formats=woff2 --subset="$path" --US_ASCII --whitelist="$S"
    mv -- "$D/${base%.*}-subset.woff2" "$D/-${base%.*}.woff2"
)

printf '@include font("%s", "%s", %s, %s, %s);\n' \
    "${base%.*}.woff2" "$family" "$weight" "$style" \
    'U+0-10FFFF'

printf '@include font("%s", "%s", %s, %s, %s);\n' \
    "-${base%.*}.woff2" "$family" "$weight" "$style" \
    "$(npx glyphhanger --US_ASCII --whitelist="$S")"
